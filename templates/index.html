<!-- templates/index.html (Minor text changes) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... Head section is unchanged ... -->
</head>
<body>
    <div class="debug-panel"><!-- ... Debug panel is unchanged ... --></div>
    <div class="main-content">
        <div class="container">
            <h1>Analytical Note Generation Workflow</h1>
            {% if message %}<div class="message {{ message_type or '' }}">{{ message }}</div>{% endif %}

            <!-- Step 1 is unchanged -->
            <div id="step1" class="step-container {{ 'active' if step == 1 else '' }} {{ 'completed' if step > 1 else '' }}">
                <h2>Step 1: Deep Research</h2>
                <form action="/run_step1" method="post">
                    <textarea name="prompt_step1" id="prompt_step1_text" class="prompt-box">{{ prompts.step1 }}</textarea>
                    <div class="prompt-controls"><button type="submit" class="action-button">Execute Research</button><!-- ... other buttons ... --></div>
                </form>
            </div>

            <!-- Step 2 is unchanged -->
            <div id="step2" class="step-container {{ 'active' if step == 2 else '' }} {{ 'completed' if step > 2 else '' }}">
                {% if step >= 2 %}
                <h2>Step 2: Article Selection</h2>
                <form action="/run_step2" method="post">
                    <!-- ... rest of the form is unchanged ... -->
                    <button type="submit" class="action-button">Select & Scrape Articles</button>
                </form>
                {% endif %}
            </div>
            
            <!-- Step 3 now generates the note directly -->
            <div id="step3" class="step-container {{ 'active' if step == 3 else '' }} {{ 'completed' if step > 3 else '' }}">
                {% if step >= 3 %}
                <h2>Step 3: Content Generation</h2>
                <p>Review the master prompt containing scraped data. Click below to generate the full analytical note.</p>
                <form action="/run_step3" method="post">
                    <textarea name="prompt_step3" id="prompt_step3_text" class="prompt-box" style="height: 400px;">{{ prompts.step3 }}</textarea>
                    <div class="prompt-controls"><button type="submit" class="action-button">Generate Analytical Note</button><!-- ... other buttons ... --></div>
                </form>
                {% endif %}
            </div>

            <!-- Step 4 is now for publishing -->
            <div id="step4" class="step-container {{ 'active' if step == 4 else '' }}">
                {% if step >= 4 %}
                    <h2>Step 4: Publish</h2>
                    <p>The final analytical note is below. Make final edits and generate the Tilda HTML.</p>
                    <form action="/run_step4" method="post">
                        <textarea name="final_markdown_digest" class="prompt-box" style="height: 400px;">{{ results.step4_markdown }}</textarea><br>
                        <button type="submit" class="action-button">Generate Tilda HTML</button>
                    </form>
                    {% if results.step4_tilda_html %}
                    <div id="step4_results" style="margin-top: 20px;">
                        <h3>Tilda.cc HTML Code:</h3>
                        <textarea id="tilda_html_code" class="prompt-box" style="height: 400px; background-color: #e9ecef;" readonly>{{ results.step4_tilda_html }}</textarea>
                        <div class="prompt-controls"><button type="button" class="action-button copy-button" onclick="copyToClipboard('tilda_html_code')">Copy HTML</button></div>
                    </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <!-- ... Script tag is unchanged ... -->
</body>
</html>
